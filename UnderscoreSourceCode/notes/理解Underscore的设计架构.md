# 理解Underscore的设计架构

在一个多月的毕业设计之后，我再次开始了Underscore的源码阅读学习，断断续续也写了好些篇文章了，基本把一些比较重要的或者个人认为有营养的函数都解读了一遍，所以现在学习一下Underscore的整体架构。我相信很多程序员都会有一个梦想，那就是可以写一个自己的模块或者工具库，那么我们现在就来学习一下如果我们要写一个自己的Underscore，我们该怎么写？

大致的阅读了一下Underscore源码，可以发现其基本架构如下：

## 1 定义下划线

Underscore的意思即为下划线，整个Underscore的核心也就是变量_，通过_对象，可以接触到Underscore公开的接口，比如_.map、_.mixin、_.template等等。所以可能有如下代码：

    var _ = {
        map: function() {
            // ...
        },
        filter: function() {
            // ...
        }
        //...
    };

上面代码定义了一个变量_，通过这个变量，我们可以使用其中的一些方法。
但是上述代码不适合开发复杂的类库，如果你前文定义了_变量，那么它会直接覆盖掉_的值。而且如果你需要写一些辅助工具类函数帮你实现公开接口但是又不想暴露给外部环境（比如chainResult函数）怎么办？直接写在外部环境会污染全局环境，将接口暴露，所以我们需要构建一个局部环境，在环境内随意定义变量而不会污染全局环境，所以我们应该在函数内部写代码，这样的话定义的所有变量都是函数的私有变量，外部无法访问。此外，对象字面量方式构建大型变量不便于组织代码，而且使用起来不够灵活，最好是使用构造器模式。

所以代码的基本结构变成了：

    (function() {
        var _ = function() {
            // ...
        };
        // ...
    })()

这样定义的话就使的我们可以将_作为函数使用，